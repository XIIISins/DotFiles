#!/bin/bash

#set -x

export setB=$1
export brightnessFile="/sys/class/leds/smc::kbd_backlight/brightness"
# re='^[0-9]+([*][0-9]+)?$'
re='^[0-9]+$'

if [ -z $# ]; then
	echo "give number 0-100"
	exit 1
fi

if ! [[ $setB =~ $re ]]; then
	echo "expected a number"
	exit 1
fi

if [[ $setB -gt "100" ]]; then
	echo "cannot be greater then 100"
	exit 1
fi

set_perm(){
	File=$1
	cur_perm=`stat -c %a $1`
	if ! [[ $cur_perm -eq "$2" ]]; then
		sudo chmod $2 $File
	fi
}

set_brightness(){
	sudo cat <<EOF > $brightnessFile
$1
EOF

	if [ $? -eq '0' ]; then
		echo "kbd backlight set to: $1"
	else
		exit 1
	fi
}

set_perm $brightnessFile 666
set_brightness $setB
set_perm $brightnessFile 644